# CarND-Path-Planning-Project
Self-Driving Car Engineer Nanodegree Program

### Objective

The goal for the Udacity Path Planning Project is to write code that allows a vehicle to navigate a simulated highway scenario for 4.23 miles while not exceeding maximum values for velocity, acceleration, and jerk as well as avoiding collisions with other vehicles and remaining in its lane. The project provides way points that denote the center lane line of the highway and functions to switch between a global frame of reference and a frenet frame of reference. The vehciles that spawn on the track occur in a random manner and can range in behavior from normal to eratic necesitating a robust algorithm for the host vehicle.

![Distance Without Incident](img/DistanceWithoutIncident_2.png)

### State Machine

The approach to this project can be broken down into two parts: deciding the speed and location of the host vehicle and developing a set of points for the simulator so the those decisions can be executed. Host vehicle decisions are broken down into speed control and lane occupation. The goal for speed control is to drive as close to 50 mph without exceeding the speed limit or hitting other vehicles on the road. To accomplish this the relative distance between the host vehicle and the next vehicle which occupys its lane is determined. The host vehicle is allowed to travel at a maximum speed just below 50 mph until it comes within 30 meters of the next vehicle in its lane at which point the host vehicle will decelerate at 2.5 m/s^2 until it reaches the velocity of the vehicle in front of it. If the host vehicle moves outside of the 30 meter barrier between it and the next actor or executes a lane change into an open lane it is allowed to speed back up to just below 50 mph at a rate of 5 m/s^2. To determine the proper lane for the host vehicle a state machine and heuristic were implemented. The heuristic outputs a value to determine if the vehicle should maintain its current lane or switch to a lane which offers the opportunity to move at a faster speed. 

![StateMachine](img/StateMachine.png)

The state machine consisted of three cases from 0 to 2 corresponding to the different lanes which the vehicle could potentially occupy. The host vehicle was allowed to move from State 0 to State 1, State 1 to State 0 or 2, and from State 2 back to State 1. Logic was also implemented to ensure that the vehicle had to have fully completed a lane change before it could execute a new lane change to help limit the host vehicle from occiliating back and forth between two lanes that both achieve a similar output from the heuristic. The heuristic is a simple addition of the next vehicles distance to the host vehicle and that vehicles speed. In the event that the distance to the next vehicle add to its speed is greater than the current distance to the next vehicle and its speed in the host vehicle's lane the host vehicle should consider changing lanes. The host vehicle will not execute a lane change in the event that there is an approaching vehicle from behind within 7 meters and that vehicle is traveling faster than the host vehicle. 

### Trajectory Generation

Once the appropriate speed and lane is determined for the vehicle a set of way points, representing the desried trajectory, needs to be developed. My implementation is influenced by the work of Aaron Brown as presented in the Path Planning Project Q&A. This process begins by adding the remaining points from the previous path to the next path. This helps to ensure a smooth transition between each vehicle state and helps to mitigate the possibility of discontinuities between the states. In the case that there are no previous way points to ingest the first two points are generated as the vehicles current position and a point prior to its position that is tagent to its current heading.

After ingesting the previous paths points a set of way points are pulled from the frenet frame at 40 meters, 60 meters, and 90 meters, in the desired lane of travel, and converted to the global XY coordinate frame. With the point just before the current vehicle posisiton and the current vehicle position these points will form the skeleton from which the spline will be sampled. These points are converted from the global XY frame to the host vehicle's reference frame. This step ensures that, when generating the spline each X point is farther away from the host vehicle than the previous X point. Once the points are in the host vehicles reference frame they are sampled such that the distance between the points, when evaluated every 20 ms, result in the target vehicle speed. Instead of determining the exact spline length between each point a line is drawn from the host vehicles position to a target point on the spline 20 meters along the x-axis. The length of this line is determined and then divied by 0.02 times the target speed to determine the freqency at which the spline should be sampled to maintain the desired vehicle speed. Once the points have been genereated they are pushed to the back of the trajectory array and provided to the simulator.
